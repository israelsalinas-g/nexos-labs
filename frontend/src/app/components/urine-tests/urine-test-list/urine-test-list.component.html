
    <div class="container">
      <div class="header">
        <div class="header-left">
          <h1>Generales de Orina</h1>
        </div>
        <button class="btn btn-primary" routerLink="/urine-tests/new">
          ‚ûï Nuevo Examen
        </button>
      </div>
      
      <div *ngIf="loading" class="loading">
        üîÑ Cargando ex√°menes de orina...
      </div>
      
      <div *ngIf="error" class="error">
        ‚ùå Error: {{ error }}
        <br><small>Verifica que el backend est√© ejecut√°ndose en http://localhost:3000</small>
      </div>

      <div *ngIf="successMessage" class="success">
        ‚úÖ {{ successMessage }}
      </div>

      <!-- Filters Section -->
      <div *ngIf="!loading && !error" class="filters">
        <div class="filter-group">
          <label for="statusFilter">Estado:</label>
          <select id="statusFilter" [(ngModel)]="filters.status" (ngModelChange)="applyFilters()">
            <option value="">Todos los estados</option>
            <option *ngFor="let option of statusOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label for="dateFromFilter">Desde:</label>
          <input 
            id="dateFromFilter" 
            type="date" 
            [(ngModel)]="filters.dateFrom" 
            (change)="applyFilters()"
          >
        </div>

        <div class="filter-group">
          <label for="dateToFilter">Hasta:</label>
          <input 
            id="dateToFilter" 
            type="date" 
            [(ngModel)]="filters.dateTo" 
            (change)="applyFilters()"
          >
        </div>

        <div class="filter-group checkbox-group">
          <label>
            <input 
              type="checkbox" 
              [(ngModel)]="filters.hasAbnormalResults" 
              (change)="applyFilters()"
            >
            Solo resultados anormales
          </label>
        </div>

        <div class="filter-actions">
          <button class="btn btn-secondary" (click)="clearFilters()">
            üóëÔ∏è Limpiar Filtros
          </button>
        </div>
      </div>

      <!-- Results Table -->
      <div *ngIf="!loading && !error && urineTests.length > 0" class="table-container">
        <table class="results-table">
          <thead>
            <tr>
              <th (click)="sort('patient.name')">
                Paciente
                <span class="sort-indicator" [class.active]="sortField === 'patient.name'">
                  {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                </span>
              </th>
              <th (click)="sort('testDate')">
                Fecha Examen
                <span class="sort-indicator" [class.active]="sortField === 'testDate'">
                  {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                </span>
              </th>
              <th>Examen F√≠sico</th>
              <th>Examen Qu√≠mico</th>
              <th>Microsc√≥pico</th>
              <th (click)="sort('status')">
                Estado
                <span class="sort-indicator" [class.active]="sortField === 'status'">
                  {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                </span>
              </th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let test of urineTests; trackBy: trackByTestId" 
                [class.abnormal-row]="hasAbnormalResults(test)">
              <td>
                <div class="patient-info">
                  <strong>{{ test.patient?.name || 'Paciente no disponible' }}</strong>
                  <small *ngIf="test.patient?.age">{{ test.patient?.age }} a√±os</small>
                </div>
              </td>
              <td>
                <div class="date-info">
                  <strong>{{ formatDate(test.testDate) }}</strong>                  
                </div>
              </td>
              <td>
                <div class="physical-results">
                  <div *ngIf="test.color" class="result-item">
                    <span class="label">Color:</span>
                    <span class="value" [class]="getColorClass(test.color)">{{ test.color }}</span>
                  </div>
                  <div *ngIf="test.aspect" class="result-item">
                    <span class="label">Aspecto:</span>
                    <span class="value">{{ test.aspect }}</span>
                  </div>
                  <div *ngIf="test.volume" class="result-item">
                    <span class="label">Volumen:</span>
                    <span class="value">{{ test.volume }}</span>
                  </div>
                  <span *ngIf="!hasPhysicalResults(test)" class="no-data">Sin datos</span>
                </div>
              </td>
              <td>
                <div class="chemical-results">
                  <div *ngIf="test.protein" class="result-item">
                    <span class="label">Prote√≠na:</span>
                    <span class="value" [class]="getResultClass(test.protein)">{{ test.protein }}</span>
                  </div>
                  <div *ngIf="test.glucose" class="result-item">
                    <span class="label">Glucosa:</span>
                    <span class="value" [class]="getResultClass(test.glucose)">{{ test.glucose }}</span>
                  </div>
                  <div *ngIf="test.bilirubin" class="result-item">
                    <span class="label">Bilirrubina:</span>
                    <span class="value" [class]="getResultClass(test.bilirubin)">{{ test.bilirubin }}</span>
                  </div>

                  <span *ngIf="!hasChemicalResults(test)" class="no-data">Sin datos</span>
                </div>
              </td>
              <td>
                <div class="microscopic-results">
                  <div *ngIf="test.bacteria" class="result-item">
                    <span class="label">Bacterias:</span>
                    <span class="value" [class]="getBacteriaClass(test.bacteria)">{{ test.bacteria }}</span>
                  </div>
                  <div *ngIf="test.epithelialCells" class="result-item">
                    <span class="label">C√©lulas Epiteliales:</span>
                    <span class="value">{{ test.epithelialCells }}</span>
                  </div>
                  <span *ngIf="!hasMicroscopicResults(test)" class="no-data">Sin datos</span>
                </div>
              </td>
              <td>
                <span class="status" [class]="getStatusClass(test.status)">
                  {{ getStatusText(test.status) }}
                </span>
                <div *ngIf="hasAbnormalResults(test)" class="abnormal-indicator">
                  ‚ö†Ô∏è Anormal
                </div>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="action-btn view-btn" (click)="viewDetails(test.id)" title="Ver detalle">
                    üëÅÔ∏è Ver
                  </button>
                  <button class="action-btn edit-btn" (click)="editTest(test.id)" title="Editar examen">
                    ‚úèÔ∏è Editar
                  </button>
                  <button 
                    class="action-btn" 
                    [class.status-active-btn]="test.isActive"
                    [class.status-inactive-btn]="!test.isActive"
                    (click)="deleteTest(test.id)"
                    [title]="test.isActive ? 'Desactivar examen' : 'Activar examen'">
                    {{ test.isActive ? 'ÔøΩ Desactivar' : 'üü¢ Activar' }}
                  </button>
                  <button class="action-btn pdf-btn" (click)="generateReport(test.id)" title="Descargar PDF">
                    ÔøΩÔ∏è PDF
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div *ngIf="!loading && !error && totalPages > 1" class="pagination">
        <button 
          class="btn" 
          [disabled]="currentPage === 1" 
          (click)="goToPage(currentPage - 1)">
          ‚Üê Anterior
        </button>
        
        <span class="page-info">
          P√°gina {{ currentPage }} de {{ totalPages }} 
          ({{ totalItems }} ex√°menes)
        </span>
        
        <button 
          class="btn" 
          [disabled]="currentPage === totalPages" 
          (click)="goToPage(currentPage + 1)">
          Siguiente ‚Üí
        </button>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && !error && urineTests.length === 0" class="empty-state">
        <p>üß™ No hay ex√°menes de orina disponibles</p>
        <small>Los ex√°menes aparecer√°n aqu√≠ cuando sean creados</small>
        <button class="btn btn-primary" routerLink="/urine-tests/new">
          Crear Primer Examen
        </button>
      </div>

      <!-- Modal de confirmaci√≥n -->
      <div class="modal" *ngIf="showConfirmModal" (click)="closeModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <h3>{{ confirmAction.title }}</h3>
          <p>{{ confirmAction.message }}</p>
          <div class="modal-actions">
            <button class="btn-secondary" (click)="closeModal()">Cancelar</button>
            <button class="btn-danger" (click)="confirmAction.action()">Confirmar</button>
          </div>
        </div>
      </div>
    </div>